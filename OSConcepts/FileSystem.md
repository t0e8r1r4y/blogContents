# File system

> 운영체제 책의 10장 내용 ( 목차는 책 목차 구성을 따름 )  
> 이해가 어려운 부분은 인터넷에서 내용을 찾고 함께 정리하였습니다.

<br>


## 1️⃣ 파일의 개념

#### ✅ 파일 속성
- 이름, 식별자, 타입, 위치, 크기, 보호, 시간, 날짜, 사용자 식별 등이 있음

#### ✅ 파일 연산 ( 파일 조작에 필요한 최소 연산 )
- 파일 생성, 파일 쓰기, 파일 읽기, 파일 삭제, 파일 절단
- 파일을 읽고 쓰는 작업을 하는 경우 파일에 읽기 쓰기 목적의 `파일 포인터`가 필요하다.
- 어떤 언어를 사용하던 파일포인터를 기준으로 한다. (C에서는 FILE *, java에서 new RandomAccessFile("파일명", "rw").getFilePointer() )
- 대부분의 읽기와 쓰기는 `현재 파일 위치 포인터`를 기준으로 한다. 이렇게 함으로서 공간을 절약하고 시스템 복잡성을 감소한다.
- 운영체제는 파일이 맨 처음 사용될 때 open() 시스템 콜을 호출하며, 모든 열린 파일의 정보를 `열린 파일 테이블(open file table)`을 유지한다.
  - 여러 프로세스가 동시에 파일을 여는 경우 보통 열린 계수(Open Count)를 각 파일에 연관해 두고 사용한다.
  - 열린 계수가 0이면 파일은 더 이상 사용되지 않음을 나타내고 열린 파일 테이블로부터 제거된다.

> 🤔 파일포인터와 파일 열린계수는 제대로 이해할 필요가 있다.

🥇 파일포인터 : 읽기와 쓰기 시스템 호출의 일부분으로 파일 오프셋을 포함하지 시스템은 현재 파일 위치 포인터로서 가장 최근의 읽기/쓰기 위치를 추적해야 한다. 이 포인터는 파일 연산을 수행하는 각 프로세스에 대해 유일하게 하나씩 만들어지므로 디스크 상의 파일 속성들과는 분리되어 유지되어야 한다.

🥇 파일 열린 계수 : 파일이 닫히면, 운영체제는 열린 파일 테이블 항목들을 재사용해야 한다. 아니면 테이블의 공간이 모자라게 될 것이다. 여러 프로세스가 파일을 열 수 있기 때문에, 시스템은 열린 파일 테이블 항목을 제거하기 전에 마지막 파일이 닫히기까지 기다려야 한다. 이 계수는 파일의 총 open()과 close()의 수를 추적하며, 이 계수 값이 0에 도달하면 그 때 시스템은 항목을 제거 할 수 있다.

file을 제어함에 있어서도 잠금 기능이 제공된다.
- 공유잠금
- 배타적인 잠금

#### ✅ 파일 유형
- 확장자에 따라 다르다.


#### ✅ 파일의 기본 구성
- 필드 : 특정한 의미를 지닌 하나 이상의 바이트, 레코드를 구성하는 기본 구성 단위 항목(item)
- 레코드 : 여러개의 필드가 모여 레코드를 이룸
- 파일 : 여러개의 레코드가 모여 파일을 이룸
  - 논리적인 저장 단위로 관련된 정보 자료들의 집합
- 어느 경우든 파일은 일련의 블록으로 간주가 된다.
- 블록의 크기가 클수록 `내부 단편화의 문제`가 커진다.

<br/>

## 2️⃣ 파일 접근 방법

#### ✅ 순차 접근
- 파일의 정보가 레코드 순서대로 처리된다. 카세트 테이프를 사용한는 방식과 동일
- 현재 위치에서 읽거나 쓰면 offset 이 자동으로 증가하고, 뒤로 돌아가려면 다시 되돌려야함.

#### ✅ 직접 접근
- 파일의 레코드를 임의의 순서로 접근할 수 있다.
- 읽기 / 쓰기의 순서에 제약이 없다.


#### ✅ 색인 접근
- 파일에서 레코드를 찾기 위해 색인을 먼저 찾고, 대응하는 포인터를 통해 접근 한다.
- 크기가 큰 파일에서 유용하다.

#### 기타 접근 방법

<br/>

## 3️⃣ 디렉터리와 디스크 구조

#### ✅ 저장 장치의 구조
- tmpfs : 희발성 주 메모리에 생성되고 시스템이 재부팅되거나 고장났을 때 파일시스템의 내용이 지워지는 임시 파일 시스템
- objfs : 디버거가 커널 심볼을 접근할 수 있게 하는 가상 파일 시스템
- ctfs : 시스템이 부트될 때 시작하여 운영체제가 실행되는 동안 실행되어야 하는 프로세스를 관리하기 위한 "contract" 정보를 저장하기 위한 가상 파일 시스템
- lofs : 한 파일 시스템 대신에 다른 파일 시스템을 접근할 수 있게 하는 "loop back" 파일 시스템
- 등등


#### ✅ 디렉터리 개관
- 파일 시스템 내부에 있으며, 디스크에 존재하는 파일에 대한 정보를 가지고 있는 테이블
- 각 파일의 위치, 크기, 할당 방식, 형태, 소유자 등의 정보를 가짐.


#### ✅ 1단계 디렉터리
- 모든 파일이 같은 디렉토리에서 관리되는 가장 간단한 구조


#### ✅ 2단계 디렉터리
- 각 사용자에게 서로 다른 디렉토리를 할당


#### ✅ 트리구조 디렉터리
- 하나의 루트 디렉토리와 다수의 서브 디렉토리로 구성
- 서로 다른 디렉토리 내에서도 동일한 이름의 파일이나 디렉토리 생성가능
- 파일 및 디렉토리 탐색은 절대 경로, 상대 경로를 이용함.
    - 절대 경로 : 루트 디렉토리 기준에서 해당 파일이나 디렉토리 까지의 경로
    - 상대 경로 : 현재 디렉토리 기준에서 해당 파일이나 디렉토리 까지의 경로
- Windows, Unix 운영체제에서 사용하는 구조

#### 비순환 그래프 디렉터리
#### 일반 그래프 디렉터리

<br/>

## 4️⃣ 파일 시스템 마운팅
- 파일이 사용되기 전에 열리는 것처럼 파일 시스템은 프로세스들에 의해 사용되기 전에 마운트 되어야 한다.
- 정확하게 디렉터리 구조는 다양한 파티션으로부터 만들어 질 수 있는데, 각 파티션들이 마운트되어야 파일 시스템 네임 스페이스 안에서 이용 가능하다.
- 마운트를 위해서 파일구조내 위치(마운트 포인트)가 주어진다.

## 5️⃣ 파일 공유
- 정리중

## 6️⃣ 보안
- 







## Reference
- 운영체제 책
