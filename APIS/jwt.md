# 세션과 토큰방식의 인증


## 설명의 전개방향

### 1. 둘을 사용하는 목적이 뭔가?

- 둘을 사용하는 목적은 Authentication(요청)이다. ( not Authorization(인가) )
- 인증은 요청의 신원을 확인한다.
- 인가 → 인증이 된 사용자에게 특정 리소스나 기능에 액세스 할 수 있는 권한을 부여하는 것
- 사용자의 요청에 대해서 그 요청이 신뢰할 수 있는지를 인증하는 작업이다.

<img width="545" alt="Untitled" src="https://user-images.githubusercontent.com/91730236/198839907-c442152a-bf6b-4e5a-8292-9920dbf5a085.png">

### 2. 목적을 달성하기 위한 방식의 차이를 설명한다.

<aside>
☝ 답변에서 위 내용을 보통은 면접관은 알고 있기에 생략을 한다.

</aside>

---

## 세션과 토큰 방식에 대한 세부 내용 정리

### 세션 인증방식

![Untitled 1](https://user-images.githubusercontent.com/91730236/198839917-100b40e7-c6c7-42ad-964b-167f648d8cae.png)

- 세션의 형태는 보통 JSON format의 작은 파일이다.
- 이 파일은 유저의 ID나 로그인,만료에 대한 시간과 같은 정보들이 저장되어 있다.
- 이는 client의 요청에 대해서 서버가 생성하고 해당 정보를 서버에 저장한다. → 서버기반의 인증 방식
- 유저의 요청에 대해서 client의 정보를 keep track하기 위함이다.  → 세션을 유지한다. → 세션 저장소(메모리 혹은 DB)
- client는 서버로 부터 세션을 받게되면 새로운 요청(F5)에 대해서 해당 정보를  서버로 전송한다.
- 서버는 client의 정보를 인식한다.

### 특징과 장단점

- 특징1 : 세션은 서버에 저장된다.
    - 장점 : client의 정보 변경에 따라서 서버가 해당 세션을 무효화 할 수 있다. 또한 신뢰할 수 있는 유저인지 서버에서 추가로 확인이 가능하다.
    - 장점 : 즉 서버에서 client의 세부 정보를 확인 할  수 있다. → Stateful 서버의 특징
    - 단점 : 서버에 저장 된 정보를 조회하기 때문에 MSA 환경에서 다른 서버에 접근 시 확장성이 떨어진다.
- 특징2 : 쿠키 형태로 데이터를 주고 받는다.
    - 단점 : 보안에 취약하다. 사이트 간 요청 위조 공격에 노출 될 수 있다. 세션 ID를 가로채서 서버에 유해한 요청을 수행할 수 있는 man-in-the-middle 공격의 가능성과 관련이 있다.
    - 단점 : 웹 어플리케이션에서 세션을 관리할 때 사용되는 쿠키는 단일 도메인 및 서브 도메인에서만 작동하도록  설계되어 있다. 따라서 쿠키를 여로 도메인에서 관리하는것은 번거롭다. ( CORS - Cross Origin Resource Sharing )
    

### 토큰 기반 인증방식

![Untitled 2](https://user-images.githubusercontent.com/91730236/198839911-18a3d623-9e64-45b1-8d81-e352bb0a863b.png)

- 토큰은  인증 파일인데 변조할 수 없는 특징이 있다.
- 서버에서 비밀 키를 사용하여 생성한다.
- 서버는 client에게 비밀 키를 전달하고 로컬에 저장한다.
- 사용자는 새로운 요청이 있을 때마다 이 토큰을 서버에 전송한다.
- 서버는 이 서명을 확인하고 요청을 승인한다.
- 이 행위는 단순히 토큰을 확인하는 것이지 토큰에 매핑 된 사용자가 누구인지를 식별하는 것은 아니다. → 즉 상태를 유지하지 않고 관리하지 않는다 stateless한 구조다.
- 즉 요청을 OK하는 것!

### 특징과 장단점

- 특징1 : 토큰을 사용한다.
    - 장점 : 사용자의 자격 증명을 보내야 하는 횟수를 줄일 수 있다.
    - 장점 : 서버는  사용자의 요청을 승인하기 위해 세션 세부 정보를 지속적으로 살펴 보지 않아도 된다 → 즉 성능이 향상 될 수 있다.
    - 장점 : 토큰은 변조가 불가능하다. 탈취에 대한 리스크는 있지만, 변조에 대한 리스크는 없다.
    - 단점 : 탈취에 대한 리스크가 생긴다.
- 특징2 : 클라이언트에 저장한다.
    - 장점 : 동일한 검증 방식을 사용한다면 다른 서버에서 동일한 토큰을 사용하여 요청을 승인할 수 있다.
    - 단점 : 클라이언트에 저장되어 있기에 보안 작업을 수행 할 수 없다.
    - 단점 : 클라이언트에서 유요한 토큰을 얻으면 이를 통해 서버로 액세스가 가능하다.
    

<aside>
☝ 토큰 방식의 특징을 무상태성(StateLess), 확장성(Scalability)
보안성 → 쿠키의 취약점이 사라진다. → 대신 토큰 환경의 취약점이 존재
확장성 →
CORS  해결이 가능하다.

</aside>

### 차이점

<img width="729" alt="Untitled 3" src="https://user-images.githubusercontent.com/91730236/198839913-ef1f0b35-c0b1-4724-8d56-161911d0c405.png">

### 결론 ( 위 아티클의 최종 결론 )

- 두 방법 모두 고유한 취약점이 있다.
    - 세션 : client의 정보를 server가 관리하기 위한 비용이 발생한다.
    - 토큰 : 둘다 client에서 탈취와 변조에 관한 보안 이슈가 있지만, token 방식은 서버가 사용자의 정보를 알고 대응을 할 수 없다는 점에서 보안의 취약점이 있다.
- 개발자가 요구 사항에 맞도록 결론을 내야 한다.
